VERSION:="$(shell hg identify -n)"

CC = g++
C = gcc

CFLAGS = -m32 -D__winz -D__VER=\"$(VERSION)\"

DEBUG_VERBOSITY=5

all: release

CFLAGS += -I"C:\compile\fftw-3.3-dll32" -I"C:\compile\GnuWin32\include" 
LDFLAGS += -lnetpbm -lfftw3-3 -lgsl -lgslcblas -lz -ltiff -L"C:\compile\GnuWin32\lib" 

CFLAGS += -D__phys_HDF -I"C:\compile\HDF_Group\HDFshared\4.2.8\include" -I"C:\compile\HDF_Group\HDF5\1.8.10\include"
LDFLAGS += -L"C:\compile\HDF_Group\HDFshared\4.2.8\lib" -L"C:\compile\HDF_Group\HDF5\1.8.10\lib" -lmfhdfdll -lhdfdll -lhdf5 -lhdf5_hl

CFLAGS += -I"C:\compile\cfit3310"
LDFLAGS += -L"C:\compile\cfit3310" -lcfitsio

objs = NaNStream.o  nPhysFormats.o  nPhysMaths.o  nPhysWave.o
sources_unwrap = $(wildcard unwrapping/*.c)

LIBS=libnPhysUnwraps.dll libnPhysImageF.dll
libs: $(LIBS)

release: CFLAGS += -O3
release: libs install

debug: CFLAGS += -g -Wall -D__phys_debug=$(DEBUG_VERBOSITY)
debug: libs install

%.o: %.cc
	$(CC) $(CFLAGS) -c $+

libnPhysImageF.dll: $(objs) libnPhysUnwraps.dll
	$(CC) $(CFLAGS) $(objs) -lnPhysUnwraps -L. $(LDFLAGS) -shared -o $@ 	

libnPhysUnwraps.dll: $(sources_unwrap)
	$(C) $(CFLAGS) -shared -o $@ $+

install: 
	copy *.dll ..\deploy
	copy *.dll ..\neutrino\release
	copy *.dll ..\neutrino\debug

clean:
	del *.o *.dll 2>nul


