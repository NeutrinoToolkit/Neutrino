M1_task:
  macos_instance:
    image: ghcr.io/cirruslabs/macos-monterey-base:latest

  script: |
     brew update
     brew install objc-codegenutils objc-run
     brew install git python cmake fftw gcc qt5 lcov pkg-config zlib cmake libtiff cfitsio hdf5 gsl clfft pandoc
     brew install iltommi/brews/hdf4
     mkdir -p build_gcc && cd build_gcc
     cmake -DCMAKE_CXX_COMPILER=g++-12 -DQt5_DIR=`brew --prefix qt@5`/lib/cmake/Qt5 -DNEUTRINO_SKIP_PLUGINS=Shell ..
     make -j$(sysctl -n hw.ncpu) install
     ../resources/macPackage/prepareapp.sh
     cp Neutrino-`uname -s`-`uname -m`.* ..
  artifacts:
    path: "Neutrino-Darwin-arm64.*"

AppImage_task:
    container:
        image: appimagecrafters/appimage-builder:latest

    env:
        DEBIAN_FRONTEND: noninteractive
        APPIMAGE_EXTRACT_AND_RUN: 1

    # Instructions:
    script: |
      apt-get update -qq && apt-get install -yy wget git pandoc cmake libnetpbm10-dev libhdf5-dev libfftw3-dev libhdf4-dev g++ build-essential libtiff5-dev libgsl-dev qt5-default qtmultimedia5-dev qttools5-dev libqt5svg5-dev libqt5scripttools5 qtscript5-dev libqt5multimediawidgets5 qttools5-dev-tools libqt5multimedia5 libqt5multimedia5-plugins lsb-release libcfitsio-dev libhdf4-dev libhdf5-dev libhdf5-100
      wget https://github.com/linuxdeploy/linuxdeploy/releases/download/continuous/linuxdeploy-x86_64.AppImage 
      wget https://github.com/linuxdeploy/linuxdeploy-plugin-qt/releases/download/continuous/linuxdeploy-plugin-qt-x86_64.AppImage
      chmod +x linuxdeploy*.AppImage
      mkdir build && cd build
      cmake -DNEUTRINO_SKIP_PLUGINS='Shell' -DCMAKE_INSTALL_PREFIX=/usr ..
      make install DESTDIR=AppDir
      LD_LIBRARY_PATH: AppDir/usr/lib ../linuxdeploy-x86_64.AppImage --appdir AppDir --plugin qt --output appimage --custom-apprun=../resources/linuxPackage/AppRun
      cp Neutrino-*.AppImage ..
    artifacts:
      path: "Neutrino-*.AppImage"
